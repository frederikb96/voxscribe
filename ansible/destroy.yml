---
- name: Remove Long STT daemon
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    install_dir: "{{ ansible_facts['env']['HOME'] }}/.local/lib/long-stt"
    bin_dir: "{{ ansible_facts['env']['HOME'] }}/.local/bin"
    systemd_dir: "{{ ansible_facts['env']['HOME'] }}/.config/systemd/user"
    runtime_dir: "{{ ansible_facts['env']['XDG_RUNTIME_DIR'] }}"

  tasks:
    - name: Stop and disable service
      ansible.builtin.systemd:
        name: long-stt
        state: stopped
        enabled: false
        scope: user
      failed_when: false

    - name: Remove systemd service file
      ansible.builtin.file:
        path: "{{ systemd_dir }}/long-stt.service"
        state: absent

    - name: Reload systemd daemon
      ansible.builtin.systemd:
        daemon_reload: true
        scope: user

    - name: Remove client symlink
      ansible.builtin.file:
        path: "{{ bin_dir }}/long-stt-ctl"
        state: absent

    - name: Remove installation directory
      ansible.builtin.file:
        path: "{{ install_dir }}"
        state: absent

    - name: Remove socket file if exists
      ansible.builtin.file:
        path: "{{ runtime_dir }}/long-stt.sock"
        state: absent

    - name: Clean up temp files
      ansible.builtin.file:
        path: "{{ item }}"
        state: absent
      loop:
        - /tmp/long-stt-result.txt
      failed_when: false

    - name: Show completion message
      ansible.builtin.debug:
        msg: "Long STT daemon removed successfully"
